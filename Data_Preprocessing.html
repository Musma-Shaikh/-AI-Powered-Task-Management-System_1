<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duration Prediction Interface</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        /* Custom scrollbar for textareas */
        textarea::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 4px;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="app" class="w-full max-w-2xl bg-white shadow-2xl rounded-xl p-8 space-y-8">
        <header class="text-center border-b pb-4">
            <h1 class="text-3xl font-extrabold text-gray-800">Task Duration Predictor</h1>
            <p class="text-gray-500 mt-1">Input features to estimate task completion time (ML Simulation)</p>
        </header>

        <!-- Input Form -->
        <div class="space-y-6">
            
            <!-- Datetime Input -->
            <div>
                <label for="startTime" class="block text-sm font-medium text-gray-700 mb-1">Task Start Time (Toronto Local Time)</label>
                <input type="datetime-local" id="startTime" name="startTime" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" required>
                <p class="text-xs text-gray-400 mt-1">Used to extract Day of Week and Hour features.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Major Input -->
                <div>
                    <label for="major" class="block text-sm font-medium text-gray-700 mb-1">User Major/Occupation</label>
                    <select id="major" name="major" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" required>
                        <!-- Based on top 10 from Python script -->
                        <option value="Unknown">Unknown</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Engineering">Engineering</option>
                        <option value="Business">Business</option>
                        <option value="Arts">Arts</option>
                        <option value="Other">Other</option>
                    </select>
                    <p class="text-xs text-gray-400 mt-1">Used for One-Hot Encoding features.</p>
                </div>

                <!-- Placeholder for Future Numerical Input -->
                <div>
                    <label for="numerical_feature" class="block text-sm font-medium text-gray-700 mb-1">Additional Numerical Feature (e.g., Task Size)</label>
                    <input type="number" id="numerical_feature" name="numerical_feature" value="5" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    <p class="text-xs text-gray-400 mt-1">Placeholder for numerical inputs (e.g., $X_{1}, X_{2}$)</p>
                </div>
            </div>

            <!-- Strategy Input -->
            <div>
                <label for="strategy" class="block text-sm font-medium text-gray-700 mb-1">Strategy/Keywords</label>
                <textarea id="strategy" name="strategy" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., 'Used recursive merge sort algorithm with memoization'"></textarea>
                <p class="text-xs text-gray-400 mt-1">Used for TF-IDF keyword extraction.</p>
            </div>
            
            <!-- Feedback Input -->
            <div>
                <label for="feedback" class="block text-sm font-medium text-gray-700 mb-1">User Feedback/Notes</label>
                <textarea id="feedback" name="feedback" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., 'The process was complex but rewarding.'"></textarea>
                <p class="text-xs text-gray-400 mt-1">Used to extract sentiment (polarity and subjectivity).</p>
            </div>

            <!-- Prediction Button -->
            <button onclick="predictDuration()" id="predictButton"
                    class="w-full py-3 px-4 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-blue-400">
                Predict Duration
            </button>
        </div>

        <!-- Result Display -->
        <div id="result" class="text-center pt-4 border-t border-gray-200 hidden">
            <p class="text-lg text-gray-600 font-medium">Estimated Task Duration:</p>
            <p id="predictionValue" class="text-5xl font-extrabold text-blue-600 mt-2">--</p>
            <p id="predictionUnit" class="text-xl text-blue-400">seconds</p>
        </div>

        <!-- Loading Indicator -->
        <div id="loading" class="text-center pt-4 hidden">
            <div class="flex items-center justify-center space-x-2">
                <svg class="animate-spin h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span class="text-blue-600 font-medium">Calculating features...</span>
            </div>
        </div>

        <!-- Error Message Box -->
        <div id="errorMessage" class="hidden bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg" role="alert">
            <p class="font-bold">Prediction Error</p>
            <p id="errorText" class="text-sm">Please ensure all required fields are filled.</p>
        </div>

    </div>

    <script>
        // Utility function to format seconds into readable HH:MM:SS
        function formatDuration(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = Math.round(seconds % 60);

            const parts = [];
            if (h > 0) parts.push(`${h}h`);
            if (m > 0 || h > 0) parts.push(`${m}m`);
            parts.push(`${s}s`);
            
            return parts.join(' ');
        }

        /**
         * A call to a Machine Learning Prediction API.
         * In a real application, this would be a fetch() call to a server endpoint.
         */
        async function mockPredict(payload) {
            console.log("Sending payload to ML API:", payload);

            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 1500));

            // --- FEATURE SIMULATION (Logic to show how input relates to features) ---
            const sentiment = payload.feedback.length > 0 ? (payload.feedback.toLowerCase().includes('good') ? 0.8 : -0.5) : 0;
            const isWeekend = new Date(payload.startTime).getDay() === 0 || new Date(payload.startTime).getDay() === 6;
            const complexityScore = payload.strategy.split(' ').length;

            // --- MOCK PREDICTION LOGIC ---
            // A simple formula based on inputs to show variation (not an actual ML model result)
            let baseDuration = 1200;
            baseDuration += complexityScore * 10;
            baseDuration += isWeekend ? 600 : 0;
            baseDuration += sentiment * 150;
            
            // Add some randomness
            baseDuration *= (0.9 + Math.random() * 0.2); // +/- 10%
            
            return { predicted_duration_seconds: Math.max(60, baseDuration) };
        }
        
        // Main function called by the button
        async function predictDuration() {
            const startTimeValue = document.getElementById('startTime').value;
            const majorValue = document.getElementById('major').value;
            const strategyValue = document.getElementById('strategy').value;
            const feedbackValue = document.getElementById('feedback').value;
            const numFeatureValue = document.getElementById('numerical_feature').value;

            const resultDiv = document.getElementById('result');
            const loadingDiv = document.getElementById('loading');
            const errorDiv = document.getElementById('errorMessage');
            const predictButton = document.getElementById('predictButton');

            // Input Validation
            if (!startTimeValue) {
                document.getElementById('errorText').textContent = "Please select a Task Start Time.";
                errorDiv.classList.remove('hidden');
                return;
            }

            // Hide previous results/errors
            resultDiv.classList.add('hidden');
            errorDiv.classList.add('hidden');
            
            // Show Loading State
            loadingDiv.classList.remove('hidden');
            predictButton.disabled = true;

            try {
                //Construct the Payload (Simulating front-end data collection)
                const payload = {
                    startTime: startTimeValue,
                    major: majorValue,
                    strategy: strategyValue,
                    feedback: feedbackValue,
                    numerical_feature: parseFloat(numFeatureValue)
                };

                //Get Prediction
                const response = await mockPredict(payload);
                const predictedSeconds = response.predicted_duration_seconds;

                // Display Result
                document.getElementById('predictionValue').textContent = formatDuration(predictedSeconds);
                document.getElementById('predictionUnit').textContent = `(${Math.round(predictedSeconds)} seconds)`;
                resultDiv.classList.remove('hidden');

            } catch (error) {
                console.error("Prediction failed:", error);
                document.getElementById('errorText').textContent = `An unknown error occurred during prediction. Check console for details.`;
                errorDiv.classList.remove('hidden');
            } finally {
                // 6. Reset State
                loadingDiv.classList.add('hidden');
                predictButton.disabled = false;
            }
        }
    </script>
</body>
</html>
