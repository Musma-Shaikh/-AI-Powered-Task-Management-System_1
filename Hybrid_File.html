<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hybrid Task Time Predictor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .card {
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #4f46e5;
            cursor: pointer;
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.3);
            transition: background 0.15s ease-in-out;
        }
    </style>
</head>
<body class="p-4 sm:p-8 min-h-screen">

    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-900 mb-2">
            AI-Powered Task Prediction
        </h1>
        <p class="text-gray-600 mb-8">
            Enter the user and task parameters below to predict the completion time using the Hybrid ML + Rule-Based system.
        </p>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- Input Form (Col 1 & 2) -->
            <div class="lg:col-span-2 space-y-6">
                <div class="card bg-white p-6 rounded-xl">
                    <h2 class="text-xl font-bold text-indigo-700 mb-4 border-b pb-2">User & Task Inputs</h2>

                    <!-- Form Grid -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">

                        <!-- Demographics & Psychometrics -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Age</label>
                            <input type="number" id="Age" value="35" min="18" max="99" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2.5">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Gender</label>
                            <select id="Gender" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2.5">
                                <option value="Male">Male</option>
                                <option value="Female" selected>Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Income ($)</label>
                            <input type="number" id="Income" value="75000" min="0" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2.5">
                        </div>

                        <div class="col-span-1 sm:col-span-2 border-t pt-4 mt-2">
                            <h3 class="text-md font-semibold text-gray-800 mb-2">Psychometrics & Complexity (1-7 Scale)</h3>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700" for="DecisionScore">Decision Score (<span id="DecisionScoreValue">5.5</span>)</label>
                            <input type="range" id="DecisionScore" min="1" max="7" step="0.1" value="5.5" oninput="document.getElementById('DecisionScoreValue').innerText = this.value" class="mt-1 w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700" for="MindfulnessScore">Mindfulness Score (<span id="MindfulnessScoreValue">4.0</span>)</label>
                            <input type="range" id="MindfulnessScore" min="1" max="7" step="0.1" value="4.0" oninput="document.getElementById('MindfulnessScoreValue').innerText = this.value" class="mt-1 w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">Task Set Complexity (1-5)</label>
                            <input type="number" id="TaskSetComplexity" value="3" min="1" max="5" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2.5">
                        </div>

                        <div class="col-span-1 sm:col-span-2 border-t pt-4 mt-2">
                            <h3 class="text-md font-semibold text-gray-800 mb-2">Performance Metrics (Points)</h3>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">Optimal Points (Max Possible)</label>
                            <input type="number" id="OptimalPoints" value="1500" min="100" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2.5">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">Earned Points (Historical Avg)</label>
                            <input type="number" id="EarnedPoints" value="1200" min="0" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2.5">
                        </div>

                        <div class="col-span-1 sm:col-span-2">
                            <label class="block text-sm font-medium text-gray-700">Strategy/Feedback Text (NLP Feature)</label>
                            <textarea id="StrategyText" rows="3" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2.5">Focus on high points and prioritize deadlines first. I find this to be a great approach.</textarea>
                        </div>

                        <div class="col-span-1 sm:col-span-2 pt-4">
                            <button onclick="predictTime()" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-xl shadow-lg text-lg font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                                Predict Task Completion Time
                            </button>
                        </div>

                    </div>
                </div>
            </div>

            <!-- Output Panel (Col 3) -->
            <div class="lg:col-span-1">
                <div class="card bg-white p-6 rounded-xl sticky top-8 space-y-4">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">Prediction Results</h2>

                    <div id="loading" class="hidden text-center text-indigo-500">
                        <svg class="animate-spin h-5 w-5 mr-3 inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Calculating Hybrid Prediction...
                    </div>

                    <div id="results" class="hidden space-y-4">
                        <div class="p-3 bg-green-50 rounded-lg border border-green-200">
                            <p class="text-sm font-medium text-green-700">Final Prediction (Hybrid):</p>
                            <p id="finalTime" class="text-3xl font-bold text-green-800">--</p>
                        </div>

                        <div class="space-y-2">
                            <p class="text-sm font-medium text-gray-700">Raw ML Prediction:</p>
                            <p id="mlTime" class="text-xl text-gray-900 font-semibold bg-gray-100 p-2 rounded-lg">--</p>
                        </div>

                        <div class="space-y-2">
                            <p class="text-sm font-medium text-gray-700">Rule-Based Adjustment Logic:</p>
                            <p id="adjustmentReason" class="text-md italic text-indigo-700 bg-indigo-50 p-2 rounded-lg">--</p>
                        </div>

                        <div class="space-y-2 pt-2 border-t">
                            <p class="text-sm font-medium text-gray-500">Performance Ratio:</p>
                            <p id="performanceRatio" class="text-sm text-gray-800">--</p>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Use a slight delay for dramatic effect/simulation
        const SIMULATION_DELAY = 1000;

        // --- Feature Engineering Simulation ---
        function simulateSentiment(text) {
            // Simple keyword-based sentiment approximation of VADER
            const textLower = text.toLowerCase();
            let score = 0.0;
            let positive = 0;

            if (textLower.includes('great') || textLower.includes('focus') || textLower.includes('good') || textLower.includes('paid off')) {
                score += 0.8;
                positive = 1;
            }
            if (textLower.includes('frustrating') || textLower.includes('slow') || textLower.includes('difficult')) {
                score -= 0.5;
            }
            if (textLower.includes('random') || textLower.includes('no strategy')) {
                score -= 0.3; // Specific negative indicator for a rule-based check later
            }

            return { SentimentScore: score.toFixed(4), PositiveSentiment: positive };
        }

        function formatSeconds(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.round(seconds % 60);
            return `${minutes} min ${remainingSeconds} sec`;
        }

        // --- Hybrid Prediction Core Logic ---
        function predictTime() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');

            // 1. Collect Raw Input Data
            const data = {
                Age: parseFloat(document.getElementById('Age').value) || 30,
                Gender: document.getElementById('Gender').value || 'Female',
                Income: parseFloat(document.getElementById('Income').value) || 75000,
                DecisionScore: parseFloat(document.getElementById('DecisionScore').value) || 5.0,
                MindfulnessScore: parseFloat(document.getElementById('MindfulnessScore').value) || 5.0,
                TaskSetComplexity: parseFloat(document.getElementById('TaskSetComplexity').value) || 3,
                OptimalPoints: parseFloat(document.getElementById('OptimalPoints').value) || 1500,
                EarnedPoints: parseFloat(document.getElementById('EarnedPoints').value) || 1200,
                StrategyText: document.getElementById('StrategyText').value || '',
            };

            // 2. Feature Engineering (Client-Side)
            const sentimentFeatures = simulateSentiment(data.StrategyText);
            const performanceRatio = data.EarnedPoints / data.OptimalPoints;

            const processedData = {
                ...data,
                SentimentScore: parseFloat(sentimentFeatures.SentimentScore),
                PositiveSentiment: sentimentFeatures.PositiveSentiment,
                PerformanceRatio: performanceRatio,
            };

            // Display performance ratio for user context
            document.getElementById('performanceRatio').innerText = `${(performanceRatio * 100).toFixed(1)}% (Earned/Optimal)`;


            // --- SIMULATED ML REGRESSION ---
            // Mimic the Python model's correlation:
            // High DecisionScore, High PerformanceRatio, High PositiveSentiment -> Lower (Better) Time
            const BASE_TIME = 2200; // Baseline time in seconds

            let mlPredictionTime = BASE_TIME
                // Psychometrics
                - (processedData.DecisionScore * 100)
                // Performance
                - (processedData.PerformanceRatio * 400)
                // Task Complexity (Higher complexity adds time)
                + (processedData.TaskSetComplexity * 80)
                // Sentiment (Positive sentiment suggests better focus/strategy)
                - (processedData.SentimentScore * 150)
                // Add some random noise for prediction variance
                + (Math.random() * 400 - 200);

            // Ensure time is realistic
            mlPredictionTime = Math.max(500, mlPredictionTime);


            // --- RULE-BASED ADJUSTMENT (Hybrid Component) ---
            let finalTime = mlPredictionTime;
            let adjustmentReason = "No specific rules triggered. ML prediction accepted.";
            const strategyTextLower = data.StrategyText.toLowerCase();

            // Rule 1: Psychometrics Override (Low Decision Score + Young Age Penalty)
            if (data.DecisionScore < 2.5 && data.Age < 30) {
                const adjustment = 300;
                finalTime += adjustment;
                adjustmentReason = `Decision Score is very low (<2.5) for younger user (<30). Added ${formatSeconds(adjustment)} penalty.`;
            }
            // Rule 2: Strategy Text Override (Uncertainty Factor)
            else if (strategyTextLower.includes('random') || strategyTextLower.includes('no strategy')) {
                const adjustment = 150;
                finalTime += adjustment;
                adjustmentReason = `Strategy indicates 'random' or 'no strategy'. Added ${formatSeconds(adjustment)} uncertainty penalty.`;
            }
            // Rule 3: Performance Flagging (High ML Time + Poor Performance)
            else if (mlPredictionTime > 2500 && performanceRatio < 0.5) {
                adjustmentReason = "ALERT: ML time is high (>2500s) and historical performance is poor (<50%). High risk of task abandonment/failure.";
            }

            // Ensure final time is realistic
            finalTime = Math.max(500, finalTime);

            // 3. Display Results
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('results').classList.remove('hidden');

                document.getElementById('mlTime').innerText = formatSeconds(mlPredictionTime);
                document.getElementById('adjustmentReason').innerText = adjustmentReason;
                document.getElementById('finalTime').innerText = formatSeconds(finalTime);
            }, SIMULATION_DELAY);
        }

        // Initialize with a prediction on load
        window.onload = function() {
            // Attach event listeners to slider inputs to trigger prediction on change
            document.getElementById('DecisionScore').addEventListener('input', (e) => document.getElementById('DecisionScoreValue').innerText = e.target.value);
            document.getElementById('MindfulnessScore').addEventListener('input', (e) => document.getElementById('MindfulnessScoreValue').innerText = e.target.value);

            predictTime();
        }
    </script>
</body>
</html>
